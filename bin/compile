#!/bin/sh

BUILD_DIR=$1
CACHE_DIR=$2
ENV_DIR=$3

indent() {
  sed -u 's/^/       /'
}

echo "-----> Initialize docs"

# if docs Gemfile is empty abort
if [ ! -s $BUILD_DIR/docs/Gemfile ]; then
  echo "docs Gemfile is empty" | indent
  exit 1
else
  echo "Remove docs BUNDLED WITH from Gemfile.lock" | indent
  sed -i -r ':begin;$!N;s/(BUNDLED WITH)\n.+//;tbegin;P;D' /app/docs/Gemfile.lock

  echo "Install docs dependencies" | indent
  bundle install --path /app/vendor/bundle --binstubs /app/vendor/bundle/bin --gemfile=/app/docs/Gemfile -j4
fi
